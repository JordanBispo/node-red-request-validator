<script type="text/javascript">

    const nodeTypeOptions = {
        color: '#5C9EDB',
        category: 'function',
        defaults: {
            name: { value: "" },
            query: { value: "", required: false },
            reqbody: { value: "", required: false },
            method: { value: "GET", required: true }
        },
        inputs: 1,
        outputs: 2,
        icon: "font-awesome/fa-check-square-o",
        label: function () {
            return this.name || "request validator";
        },
        oneditprepare: function () {
            $("#node-input-method").typedInput({
                types: [
                    {
                        value: "method",
                        options: [
                            { value: "GET", label: "GET" },
                            { value: "POST", label: "POST" },
                            { value: "PUT", label: "PUT" },
                            { value: "DELETE", label: "DELETE" }
                        ]
                    }
                ]
            })
            $("#node-input-query").typedInput({
                type: "json",
                types: ["json"]
            })
            $("#node-input-reqbody").typedInput({
                type: "json",
                types: ["json"]
            })

        }
    }

        RED.nodes.registerType('request validator', nodeTypeOptions);

</script>

<script type="text/html" data-template-name="request validator">
    <div class="form-row">
        <label for="node-input-name"><i class="fa fa-tag"></i> Request</label>
        <input type="text" id="node-input-name" placeholder="Request">
    </div>
    <div class="form-row">
        <label for="node-input-method"><i></i>Method</label>
        <input type="text" id="node-input-method">
        </div>
        <div class="form-row">
            <label for="node-input-query"><i></i> Query Params</label>
            <input type="json" id="node-input-query" placeholder='{" paramName": {"type": "string" , required: false }}'>
        </div>
        <div class="form-row">
            <label for="node-input-reqbody"><i></i> Body Params</label>
            <input type="json" id="node-input-reqbody" placeholder='{" paramName": {"type": "string" , required: false }}'>
    </div>
</script>

<script type="text/markdown" data-help-name="request validator">
Create Schemas to validate request method, body and query parameters.
Schemas are configured in this node Properties. 

### Inputs

: Method (GET, POST, PUT, DELETE) : the expected method of the request to be validated.
: Query Params (json) : the Schema of the expected query params.
: Body Params (json) : the Schema of the expected body params.

### Outputs

1. Valid Request (top output)
: msg (any) : the original msg of request.

2. Invalid Request (bottom output)
: payload (json) : the error message.
: statusCode (400 | 500) : the status code of error.


### Schema

#### Schema Params

: type (string | number | boolean | array | date | any) : the type of the param.
: required (true | false) : whether the param is required or not.
: subtype (string | number | boolean | date | any) : if the type is array, the subtype of the array elements.


#### Schema Syntax example 
```
{
    "paramName": {
        "type": "string",
        "required": true
    },
    "paramName2": {
        "type": "array",
        "subtype": "string"
    }
}
```

### Example

#### Body schema example


    {
        "name": {
            "type": "string",
            "required": true
        },
        "addressList": {
            "type": "array",
            "subtype": "string"
        }
    }
    

    1. Verify that the request body exist.
    2. Verify if exist property `name` and its type is string.
    3. If exist property `addressList` verify if its type is array and its subtype is string.
    4. If all the validations are passed, send the original msg to the node connected to the top output.
    5. If any validation fails, send the error message to the node connected to the bottom output.

</script>